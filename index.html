<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Control de Partes Diarios</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4a90e2">
  <link rel="icon" href="icon-192.png">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <header class="appbar">
    <div class="appbar-title">Control de Partes</div>
    <div class="appbar-actions">
      <button id="btnSalir" class="btn ghost hidden">Salir</button>
      <button id="btnSalirAdmin" class="btn ghost hidden">Salir</button>
    </div>
  </header>

  <main class="container">

    <!-- ========== LOGIN ========== -->
    <section id="login-section">
      <h2>Ingreso de Usuario</h2>
      <p id="msgNoUsers" class="msg warn" hidden>No hay usuarios cargados. Ingresá como admin y agregá usuarios.</p>

      <div class="grid-2">
        <div class="field">
          <label for="usuario">Usuario</label>
          <select id="usuario">
            <option value="">-- Elegí tu nombre --</option>
          </select>
        </div>

        <div class="field">
          <label for="legajo">Legajo</label>
          <input id="legajo" type="password" placeholder="Ingresá tu legajo" />
        </div>
      </div>

      <button id="btnLogin" class="btn primary">Ingresar</button>
      <p id="errorLogin" class="msg err"></p>
    </section>

    <!-- ========== OPERARIO ========== -->
    <section id="form-section" class="hidden">
      <header class="section-header">
        <h2>Parte Diario</h2>
        <p id="userActive" class="muted"></p>
      </header>

      <div class="card">
        <div class="grid-3">
          <div class="field">
            <label for="fecha">Fecha</label>
            <input id="fecha" type="date" />
          </div>

          <div class="field">
            <label for="interno">Interno</label>
            <select id="interno">
              <option value="">-- Seleccioná un interno --</option>
            </select>
          </div>

          <div class="field">
            <label for="final">Horas / Km finales</label>
            <input id="final" type="number" inputmode="numeric" placeholder="Ej: 245 o 85630" />
          </div>
        </div>

        <div class="grid-3">
          <div class="field">
            <label for="cargoCombustible">¿Cargó combustible?</label>
            <select id="cargoCombustible">
              <option value="no">No</option>
              <option value="si">Sí</option>
            </select>
          </div>

          <div id="datosCombustible" class="field-group hidden">
            <div class="grid-2">
              <div class="field">
                <label for="litros">Litros</label>
                <input id="litros" type="number" inputmode="numeric" placeholder="Ej: 100" />
              </div>
              <div class="field">
                <label for="kmCarga">Km al cargar</label>
                <input id="kmCarga" type="number" inputmode="numeric" placeholder="Ej: 85600" />
              </div>
            </div>
          </div>

          <div class="field">
            <label for="novedades">Novedades</label>
            <textarea id="novedades" rows="1" placeholder="Comentá novedades"></textarea>
          </div>
        </div>

        <div class="actions">
          <button id="btnGuardar" class="btn primary">Guardar parte</button>
          <span id="estadoServiceChip" class="badge">—</span>
        </div>

        <p id="msgGuardado" class="msg"></p>
      </div>

      <!-- Último parte -->
      <div id="ultimoParte" class="card hidden">
        <h3>Último parte de este interno</h3>
        <div class="lastpart">
          <p><strong>Fecha:</strong> <span id="uFecha">-</span></p>
          <p><strong>Final:</strong> <span id="uFinal">-</span></p>
          <p><strong>Combustible:</strong> <span id="uCombustible">-</span></p>
          <p><strong>Novedades:</strong> <span id="uNovedades">-</span></p>
        </div>
      </div>
    </section>

    <!-- ========== ADMIN ========== -->
    <section id="admin-section" class="hidden">
      <header class="tabs">
        <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
        <button class="tab-btn" data-tab="usuarios">Usuarios</button>
        <button class="tab-btn" data-tab="internos">Internos</button>
        <button class="tab-btn" data-tab="partes">Partes</button>
        <button class="tab-btn" data-tab="service">Service</button>
      </header>

      <!-- DASHBOARD -->
      <div id="tab-dashboard" class="tab">
        <div class="grid-metrics">
          <div class="metric">
            <div class="metric-value" id="mActivos">0</div>
            <div class="metric-label">Equipos activos</div>
          </div>
          <div class="metric">
            <div class="metric-value" id="mProx">0</div>
            <div class="metric-label">Próximos a service</div>
          </div>
          <div class="metric">
            <div class="metric-value" id="mMant">—</div>
            <div class="metric-label">En mantenimiento</div>
          </div>
          <div class="metric">
            <div class="metric-value" id="mUltimo">—</div>
            <div class="metric-label">Último parte registrado</div>
          </div>
        </div>

        <div class="grid-2">
          <div class="card">
            <h3>Últimos partes</h3>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>Fecha</th><th>Usuario</th><th>Interno</th><th>Final</th><th>Estado</th>
                  </tr>
                </thead>
                <tbody id="tablaUltimos"></tbody>
              </table>
            </div>
          </div>

          <div class="card">
            <h3>Equipos sin partes (≥5 días)</h3>
            <ul id="listaSinPartes" class="list"></ul>
          </div>
        </div>
      </div>

      <!-- USUARIOS -->
      <div id="tab-usuarios" class="tab hidden">
        <div class="card">
          <h3>Alta de usuario</h3>
          <div class="grid-3">
            <div class="field"><label>Nombre</label><input id="nu-nombre" type="text"></div>
            <div class="field"><label>Legajo</label><input id="nu-legajo" type="text"></div>
            <div class="field">
              <label>Rol</label>
              <select id="nu-rol">
                <option value="operario">Operario</option>
                <option value="admin">Administrador</option>
              </select>
            </div>
          </div>
          <button id="btnAddUsuario" class="btn">Agregar</button>
        </div>

        <div class="card">
          <h3>Usuarios</h3>
          <div class="table-wrap">
            <table>
              <thead><tr><th>Nombre</th><th>Legajo</th><th>Rol</th><th>Acciones</th></tr></thead>
              <tbody id="tablaUsuarios"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- INTERNOS -->
      <div id="tab-internos" class="tab hidden">
        <div class="card">
          <h3>Alta de interno</h3>
          <div class="grid-3">
            <div class="field"><label>Código</label><input id="ni-codigo" type="text" placeholder="Ej: C-185"></div>
            <div class="field">
              <label>Tipo medición</label>
              <select id="ni-tipo">
                <option value="horas">Horas</option>
                <option value="km">Kilómetros</option>
              </select>
            </div>
            <div class="field"><label>Service cada</label><input id="ni-cada" type="number" placeholder="250 / 10000"></div>
          </div>

          <div class="grid-3">
            <div class="field"><label>Último service valor</label><input id="ni-ultvalor" type="number" placeholder="hs/km"></div>
            <div class="field"><label>Último service fecha</label><input id="ni-ultfecha" type="date"></div>
            <div class="field"><label>RM</label><input id="ni-rm" type="text" placeholder="RM / pedido"></div>
          </div>

          <div class="grid-3">
            <div class="field"><label>Filtro aceite (referencia)</label><input id="ni-f-aceite" type="text"></div>
            <div class="field"><label>Filtro aire (referencia)</label><input id="ni-f-aire" type="text"></div>
            <div class="field"><label>Filtro combustible (referencia)</label><input id="ni-f-comb" type="text"></div>
          </div>

          <button id="btnAddInterno" class="btn">Agregar</button>
        </div>

        <div class="card">
          <h3>Internos</h3>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Interno</th><th>Tipo</th><th>Service cada</th>
                  <th>Últ. service</th><th>Filtros (ref.)</th><th>RM</th><th>Acciones</th>
                </tr>
              </thead>
              <tbody id="tablaInternos"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- PARTES -->
      <div id="tab-partes" class="tab hidden">
        <div class="card">
          <h3>Partes cargados</h3>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Fecha</th><th>Usuario</th><th>Interno</th><th>Final</th>
                  <th>Combustible</th><th>Novedades</th><th>Estado</th><th>Acciones</th>
                </tr>
              </thead>
              <tbody id="tablaPartes"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- SERVICE -->
      <div id="tab-service" class="tab hidden">
        <div class="card">
          <h3>Registrar Service</h3>

          <!-- Form en dos columnas (desktop) -->
          <div class="service-grid">
            <div class="service-col">
              <div class="grid-3">
                <div class="field"><label>Interno</label><select id="sv-interno"><option value="">-- Seleccioná --</option></select></div>
                <div class="field"><label>Fecha</label><input id="sv-fecha" type="date"></div>
                <div class="field"><label>Valor (hs/km)</label><input id="sv-valor" type="number" placeholder="p.ej. 10000"></div>
              </div>

              <div class="grid-3">
                <div class="field"><label>Aceite (tipo)</label><input id="sv-aceite-tipo" type="text" placeholder="15W40, etc."></div>
                <div class="field"><label>Aceite (litros)</label><input id="sv-aceite-litros" type="number" placeholder="p.ej. 16"></div>
                <div class="field"><label>RM / pedido</label><input id="sv-rm" type="text" placeholder="Referencia RM"></div>
              </div>
            </div>

            <div class="service-col">
              <!-- Filtros dinámicos SOLO TIPO, multi-fila por grupo -->
              <div class="filters-grid">
                <div class="filter-group">
                  <div class="filter-group-head">
                    <h4>Filtros de aceite</h4>
                    <button id="sv-add-aceite" class="btn small">+ Agregar</button>
                  </div>
                  <div id="sv-list-aceite" class="filter-list"></div>
                </div>

                <div class="filter-group">
                  <div class="filter-group-head">
                    <h4>Aire primario</h4>
                    <button id="sv-add-airep" class="btn small">+ Agregar</button>
                  </div>
                  <div id="sv-list-airep" class="filter-list"></div>
                </div>

                <div class="filter-group">
                  <div class="filter-group-head">
                    <h4>Aire secundario</h4>
                    <button id="sv-add-aires" class="btn small">+ Agregar</button>
                  </div>
                  <div id="sv-list-aires" class="filter-list"></div>
                </div>

                <div class="filter-group">
                  <div class="filter-group-head">
                    <h4>Combustible</h4>
                    <button id="sv-add-comb" class="btn small">+ Agregar</button>
                  </div>
                  <div id="sv-list-comb" class="filter-list"></div>
                </div>

                <div class="filter-group">
                  <div class="filter-group-head">
                    <h4>Habitáculo</h4>
                    <button id="sv-add-hab" class="btn small">+ Agregar</button>
                  </div>
                  <div id="sv-list-hab" class="filter-list"></div>
                </div>

                <div class="filter-group">
                  <div class="filter-group-head">
                    <h4>Hidráulico</h4>
                    <button id="sv-add-hid" class="btn small">+ Agregar</button>
                  </div>
                  <div id="sv-list-hid" class="filter-list"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="actions">
            <button id="btnAddService" class="btn primary">Guardar service</button>
          </div>
        </div>

        <div class="card">
          <h3>Historial de services</h3>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Fecha</th><th>Interno</th><th>Valor</th><th>Tipo</th>
                  <th>Filtros</th><th>Aceite</th><th>RM</th>
                </tr>
              </thead>
              <tbody id="tablaService"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script type="module" src="script.js?v=13"></script>
</body>
</html>
